<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IRCTC â€” Train Search </title>
  <!-- Modern Fonts: Space Grotesk (headlines) + Manrope (body) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent-deep:#0b5e57;
      --cg-accent:#10a37f;
      --cg-accent-2:#2bd39b;
      --accent-warm:#f9a62a;

      --card-bg: rgba(255,255,255,0.68);
      --overlay: rgba(0,0,0,0.36);
      --radius: 14px;
      --shadow: 0 8px 28px 0 rgba(2,11,44,0.12);

      --field-height: 48px;
      --field-padding-x: 16px;

      --heading-font: 'Space Grotesk', Arial, sans-serif;
      --body-font: 'Manrope', Arial, sans-serif;

      --input-blur-bg: rgba(16,163,127,0.02);
      --input-border: #10a37f;
      --input-shadow: 0 6px 22px rgba(16,163,127,0.10);
      --input-focus-border: #24bb92;
      --input-focus-glow: 0 0 0 4px rgba(16,163,127,0.25);

      --label-weight:600;
      --input-weight:500;
      --heading-size:2.2rem;
      --sub-size:1.08rem;

      --dark:#061313;
      --muted:#3f5451;
    }

    html,body{
      height:100%;margin:0;background:transparent;
      font-family:var(--body-font);color:var(--dark);
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    .bg-images{position:fixed;inset:0;z-index:-3;background:url('/static/images/train7.jpg') center/cover no-repeat;pointer-events:none;filter:saturate(0.95) contrast(0.98);}
    .bg-overlay{position:fixed;inset:0;z-index:-2;background:var(--overlay);backdrop-filter:blur(5px) saturate(1.05);pointer-events:none;}

    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:38px 18px;}
    .card{
      background:var(--card-bg);border-radius:var(--radius);
      max-width:980px;width:100%;
      box-shadow:var(--shadow);padding:30px 20px;margin:0 12px;
      position:relative;z-index:2;border:1px solid rgba(11,94,87,0.06);
      animation:slideUp .55s cubic-bezier(.2,.9,.3,1.08);overflow:hidden;
    }
    @keyframes slideUp{from{opacity:0;transform:translateY(28px);}to{opacity:1;transform:translateY(0);}}
    .watermark{
      position:absolute;right:20px;top:14px;width:130px;height:130px;
      opacity:1;background:url('/static/images/irctc_logo.png') center/contain no-repeat;pointer-events:none;filter:none;
    }
    .heading{
      font-family:var(--heading-font);font-size:var(--heading-size);font-weight:700;
      margin:0 0 4px 0;letter-spacing:-0.02em;line-height:1.02;
      background:linear-gradient(90deg,var(--cg-accent) 18%,#0b6b7a 100%);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      display:inline-block;padding-bottom:6px;border-bottom:3px solid rgba(16,163,127,0.10);
    }
    .sub{
      font-family:var(--body-font);font-size:var(--sub-size);font-weight:600;
      color:var(--muted);margin:8px 0 14px 0;letter-spacing:0.01em;max-width:760px;
    }
    .header{margin-bottom:18px;}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:26px 18px;align-items:start;margin-bottom:20px;}
    @media(max-width:860px){.grid{grid-template-columns:1fr;}}

    label{
      display:block;font-size:14px;margin-bottom:8px;color:var(--dark);
      font-family:var(--body-font);font-weight:var(--label-weight);
    }
    .field{position:relative;display:flex;flex-direction:column;}
    .field.icon input,
    .field.icon select,
    .field.icon .date-input{padding-left:48px !important;}
    .field .input-icon{
      position:absolute;left:14px;top:36px;z-index:2;width:22px;height:22px;opacity:0.96;
      pointer-events:none;display:flex;align-items:center;justify-content:center;color:var(--cg-accent);
    }
    .input,.date-input,.select{
      height:var(--field-height);box-sizing:border-box;padding:0 var(--field-padding-x);
      border-radius:10px;
      border:2px solid var(--input-border);
      background:var(--input-blur-bg);color:var(--dark);font-size:1.02rem;
      font-family:var(--body-font);font-weight:var(--input-weight);
      box-shadow:var(--input-shadow);
      outline:none;
      transition:box-shadow .18s,border-color .14s,background .16s,transform .12s;
      backdrop-filter:blur(4px);
    }
    .input::placeholder,.date-input::placeholder{color:rgba(11,94,87,0.28);font-size:13px;font-weight:500;}
    .input:focus,.date-input:focus,.select:focus{
      border-color:var(--input-focus-border);
      box-shadow:var(--input-focus-glow);
      background:rgba(255,255,255,0.84);
      transform:translateY(-1px);
    }
    .select{
      padding-right:42px;
      background-image:linear-gradient(45deg,#e9faf3 50%,transparent 50%);
      background-position:calc(100% - 18px) 50%;
      background-size:11px 11px;
      background-repeat:no-repeat;
    }
    .date-wrap{position:relative;display:block;}
    .date-icon{
      position:absolute;left:10px;top:50%;transform:translateY(-50%);
      width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;
      background:rgba(16,163,127,0.06);z-index:3;cursor:pointer;box-shadow:0 2px 6px rgba(16,163,127,0.06);
    }
    .date-input{padding-left:52px;}
    .date-wrap .date-input::-webkit-calendar-picker-indicator{display:none;}
    .suggestions{
      position:absolute;left:0;right:0;top:calc(100% + 8px);
      background:rgba(255,255,255,0.98);color:var(--dark);border-radius:10px;
      box-shadow:0 10px 34px rgba(3,45,41,0.06);padding:6px 0;max-height:220px;overflow:auto;
      z-index:9999;display:none;border:1px solid rgba(11,94,87,0.06);
    }
    .suggestion{
      padding:11px 18px;border-radius:9px;cursor:pointer;font-size:15px;font-family:var(--body-font);
      background:none;font-weight:600;margin:6px 8px;transition:background .12s,color .12s,box-shadow .14s;
    }
    .suggestion:hover,.suggestion[aria-selected="true"]{
      background:rgba(16,163,127,0.06);color:var(--cg-accent);
      box-shadow:0 6px 18px rgba(16,163,127,0.05);
    }
    .actions{
      display:flex;gap:14px;margin-top:18px;align-items:center;justify-content:flex-end;
    }
    .btn{
      background:linear-gradient(90deg,var(--cg-accent),var(--cg-accent-2));
      color:#fff;border:none;padding:12px 30px;border-radius:11px;font-weight:700;font-size:15.5px;
      letter-spacing:0.01em;cursor:pointer;box-shadow:0 10px 36px rgba(16,163,127,0.12);
      transition:transform .12s,box-shadow .12s;
    }
    .btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 18px 46px rgba(16,163,127,0.16);}
    .ghost{
      background:transparent;color:var(--dark);border:1px solid rgba(11,94,87,0.06);
      padding:10px 20px;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;
    }
    .ghost:hover{background:rgba(11,94,87,0.03);}
    :focus{outline:3px solid rgba(16,163,127,0.12);outline-offset:2px;}
    .loader-modal{position:fixed;left:0;top:0;width:100vw;height:100vh;z-index:9999;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(2,8,14,0.28), rgba(2,8,14,0.44));}
    .loader-content{background:rgba(255,255,255,0.04);border-radius:16px;padding:22px 26px;display:flex;flex-direction:column;align-items:center;gap:10px;min-width:200px;backdrop-filter:blur(6px) saturate(1.05);box-shadow:0 20px 60px rgba(3,29,28,0.45);}
    .loader-logo{width:68px;height:68px;border-radius:14px;background:url('/static/images/irctc_logo.png') center/contain no-repeat;filter:drop-shadow(0 8px 18px rgba(0,0,0,0.35));transform-origin:center;animation:loaderPulse 1700ms cubic-bezier(.2,.9,.3,1) infinite;}
    @keyframes loaderPulse{0%{transform:scale(0.98) rotate(-4deg);opacity:0.92}50%{transform:scale(1.06) rotate(3deg);opacity:1}100%{transform:scale(0.98) rotate(-4deg);opacity:0.92}}
    .loader-bar{width:220px;height:8px;background:rgba(255,255,255,0.08);border-radius:10px;overflow:hidden;position:relative;}
    .loader-bar-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--cg-accent),var(--accent-warm));border-radius:10px;transition:width .22s cubic-bezier(.2,1,.4,1);}
    .loader-progress-text{font-family:var(--body-font);font-weight:700;font-size:13px;color:#f1f7f3;margin-top:6px;letter-spacing:0.01em;}
    .loader-sub{font-family:var(--body-font);font-weight:600;font-size:12px;color:rgba(241,247,243,0.95);opacity:0.92;}
    @media(max-width:820px){
      .card{padding:16px 10px}
      .heading{font-size:1.18rem}
      .loader-bar{width:160px}
      .loader-logo{width:54px;height:54px}
    }
  </style>
</head>
<body>
  <div class="bg-images" aria-hidden="true"></div>
  <div class="bg-overlay"></div>
  <div class="loader-modal" id="loaderModal" aria-live="assertive" aria-label="Loading" role="alert">
    <div class="loader-content" role="status" aria-live="polite">
      <div class="loader-logo" aria-hidden="true"></div>
      <div class="loader-bar"><div class="loader-bar-fill" id="loaderBar"></div></div>
      <div class="loader-progress-text" id="loaderPercent">0%</div>
      <div class="loader-sub" id="loaderText">Searching trains... please wait</div>
    </div>
  </div>
  <div class="wrap">
    <section class="card" id="mainCard">
      <div class="watermark" aria-hidden="true"></div>
      <header class="header">
        <div>
          <h1 id="pageTitle" class="heading">Welcome to IRCTC Predictive Dashboard</h1>
          <p class="sub">Plan your journey smarter: Get train availability status, booking chances & future demand tips.</p>
        </div>
      </header>
      <form id="trainForm" action="/get_trains" method="POST" novalidate autocomplete="off">
        <div class="grid">
          <div class="field icon">
            <span class="input-icon" style="top:36px;color:var(--cg-accent);">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 15a4 4 0 1 1 8 0M12 3v12m0 0s-5 0-8 4v2h16v-2c-3-4-8-4-8-4Z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </span>
            <label for="source">Source Station</label>
            <input id="source" name="source" class="input" type="text" placeholder="Guwahati (GHY)" autocomplete="off" aria-autocomplete="list" aria-controls="source-suggestions" aria-haspopup="listbox" aria-expanded="false" required />
            <div id="source-suggestions" class="suggestions" role="listbox" aria-label="Source suggestions"></div>
          </div>
          <div class="field icon">
            <span class="input-icon" style="top:36px;color:var(--cg-accent);">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" xmlns="http://www.w3.org/2000/svg" style="transform:scaleX(-1);"><path d="M8 15a4 4 0 1 1 8 0M12 3v12m0 0s-5 0-8 4v2h16v-2c-3-4-8-4-8-4Z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </span>
            <label for="destination">Destination Station</label>
            <input id="destination" name="destination" class="input" type="text" placeholder="New Delhi (NDLS)" autocomplete="off" aria-autocomplete="list" aria-controls="destination-suggestions" aria-haspopup="listbox" aria-expanded="false" required />
            <div id="destination-suggestions" class="suggestions" role="listbox" aria-label="Destination suggestions"></div>
          </div>
          <div class="field icon">
            <span class="input-icon" style="top:36px;color:var(--cg-accent);">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5.5" width="18" height="15" rx="3.5" fill="rgba(16,163,127,0.04)"/><rect x="8" y="10" width="6.2" height="5.1" rx="2" fill="rgba(16,163,127,0.06)"/></svg>
            </span>
            <label for="journey_date">Journey Date</label>
            <div class="date-wrap">
              <div class="date-icon" aria-hidden="true" title="Open date picker">
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5.5" width="18" height="15" rx="3.5" fill="rgba(16,163,127,0.04)"/><rect x="8" y="10" width="6.2" height="5.1" rx="2" fill="rgba(16,163,127,0.06)"/></svg>
              </div>
              <input id="journey_date" name="journey_date" type="date" class="date-input" required min="" max="" />
            </div>
          </div>
          <div class="field icon">
            <span class="input-icon" style="top:36px;color:var(--cg-accent);">
              <svg viewBox="0 0 24 24" width="19" height="19" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 13.5v-5A2.5 2.5 0 0 1 10 6h4a2.5 2.5 0 0 1 2.5 2.5v5" fill="rgba(16,163,127,0.12)"/><rect x="6" y="13.5" width="12" height="4" rx="1.5" fill="rgba(16,163,127,0.08)" stroke="currentColor" stroke-width="1.2"/></svg>
            </span>
            <label for="class">Travel Class</label>
            <select id="class" name="class" class="select" required>
              <option value="">-- Select Class --</option>
              <option value="SL">Sleeper (SL)</option>
              <option value="3AC">AC 3-Tier (3A)</option>
              <option value="2AC">AC 2-Tier (2A)</option>
              <option value="1AC">AC First Class (1A)</option>
            </select>
          </div>
        </div>
        <input type="hidden" id="days_before_journey" name="days_before_journey">
        <input type="hidden" id="weekday" name="weekday">
        <input type="hidden" id="month" name="month">
        <div class="actions">
          <button type="button" class="ghost" id="resetBtn">Reset</button>
          <button type="submit" class="btn" id="searchBtn" aria-live="polite">Check Trains & Predict</button>
        </div>
      </form>
    </section>
  </div>
  <script>
    const $ = s => document.querySelector(s);
    let loaderInterval = null;

    function showLoader(){
      const modal = document.getElementById('loaderModal');
      const bar = document.getElementById('loaderBar');
      const pct = document.getElementById('loaderPercent');
      const text = document.getElementById('loaderText');

      modal.style.display = 'flex';
      bar.style.width = '0%';
      pct.textContent = '0%';
      text.textContent = 'Searching trains... please wait';

      // Intentionally slower: increase total visible time and slow down progress
      let progress = 0;
      if (loaderInterval) clearInterval(loaderInterval);

      const intervalMs = 280;            // Slower tick interval
      const minVisible = 16000;          // Slower overall loader (16 seconds)
      const tickCount = Math.max(1, Math.floor(minVisible / intervalMs));
      const baseStep = 86 / tickCount;

      loaderInterval = setInterval(() => {
        const jitter = (Math.random() - 0.5) * (baseStep * 0.45);
        progress = Math.min(progress + Math.max(0.38, baseStep + jitter), 86);
        bar.style.width = progress + '%';
        pct.textContent = Math.floor(progress) + '%';
      }, intervalMs);

      const extraDelay = 600;
      setTimeout(() => {
        if (loaderInterval) clearInterval(loaderInterval);
        let final = parseFloat(bar.style.width) || 86;
        const finInterval = setInterval(() => {
          final = Math.min(final + Math.random() * 2.5 + 1.5, 100);
          bar.style.width = final + '%';
          pct.textContent = Math.floor(final) + '%';
          if (final >= 100) { clearInterval(finInterval); setTimeout(hideLoader, 650); }
        }, 170);
      }, minVisible + extraDelay);
    }

    function hideLoader(){
      const modal = document.getElementById('loaderModal');
      const bar = document.getElementById('loaderBar');
      if (loaderInterval) clearInterval(loaderInterval);
      bar.style.width = '100%';
      setTimeout(()=>{ modal.style.display = 'none'; }, 420);
    }

    (function initDateLimits(){
      const d = new Date(); d.setHours(0,0,0,0);
      const min = d.toISOString().split('T')[0];
      const max = new Date(d.getTime() + 60*24*60*60*1000).toISOString().split('T')[0];
      document.getElementById('journey_date').min = min;
      document.getElementById('journey_date').max = max;
      const tomorrow = new Date(d.getTime() + 24*60*60*1000);
      document.getElementById('journey_date').value = tomorrow.toISOString().split('T')[0];
      updateHiddenDateFields();
    })();

    function updateHiddenDateFields(){
      const val = document.getElementById('journey_date').value;
      if (!val) return;
      const jd = new Date(val + 'T00:00:00');
      const today = new Date(); today.setHours(0,0,0,0);
      document.getElementById('days_before_journey').value = Math.floor((jd - today)/(1000*60*60*24));
      document.getElementById('weekday').value = jd.getDay();
      document.getElementById('month').value = jd.getMonth() + 1;
    }
    document.getElementById('journey_date').addEventListener('change', updateHiddenDateFields);

    function attachAutocomplete(inputId, suggestionsId, fetchUrl){
      const input = document.getElementById(inputId);
      const box = document.getElementById(suggestionsId);
      let items = [];
      let idx = -1;
      let suppress = false;
      let debounceTimer = null;

      input.addEventListener('input', async function(){
        if (suppress) return;
        const q = input.value.trim();
        if (!q) { box.style.display = 'none'; input.setAttribute('aria-expanded','false'); return; }
        if (debounceTimer) clearTimeout(debounceTimer);
        debounceTimer = setTimeout(async () => {
          try {
            const res = await fetch(`${fetchUrl}?q=${encodeURIComponent(q)}`);
            const data = await res.json();
            items = Array.isArray(data) ? data : [];
          } catch (err) { items = []; }
          render();
        }, 160);
      });

      function render(){
        box.innerHTML = '';
        if (!items || items.length === 0) { box.style.display='none'; input.setAttribute('aria-expanded','false'); return; }
        items.forEach((it, i) => {
          const div = document.createElement('div');
          div.className = 'suggestion';
          div.role = 'option';
          div.tabIndex = 0;
          div.id = suggestionsId + '-item-' + i;
          div.textContent = it;
          function selectItem(ev){
            suppress = true;
            input.value = it;
            box.style.display = 'none';
            input.setAttribute('aria-expanded','false');
            idx = -1;
            setTimeout(()=>{ suppress = false; input.focus(); }, 40);
            if (ev && typeof ev.preventDefault === 'function') ev.preventDefault();
          }
          div.addEventListener('mousedown', selectItem);
          div.addEventListener('touchstart', selectItem);
          div.addEventListener('keydown', function(ev){ if (ev.key === 'Enter'){ selectItem(ev); ev.preventDefault(); }});
          box.appendChild(div);
        });
        idx = -1;
        box.style.display = 'block';
        input.setAttribute('aria-expanded','true');
      }

      input.addEventListener('keydown', function(e){
        const list = box.querySelectorAll('.suggestion');
        if (box.style.display === 'none' || list.length === 0) return;
        if (e.key === 'ArrowDown'){ e.preventDefault(); idx = Math.min(idx + 1, list.length - 1); list[idx].focus(); list.forEach((el,i)=>el.setAttribute('aria-selected', i === idx)); }
        else if (e.key === 'ArrowUp'){ e.preventDefault(); idx = Math.max(idx - 1, 0); list[idx].focus(); list.forEach((el,i)=>el.setAttribute('aria-selected', i === idx)); }
        else if (e.key === 'Enter'){ if (idx >= 0 && list[idx]){ e.preventDefault(); list[idx].dispatchEvent(new KeyboardEvent('keydown',{key:'Enter'})); } }
        else if (e.key === 'Escape'){ box.style.display = 'none'; input.setAttribute('aria-expanded','false'); idx = -1; }
      });

      document.addEventListener('mousedown', function(ev){
        if (!box.contains(ev.target) && ev.target !== input) {
          box.style.display = 'none'; input.setAttribute('aria-expanded','false'); idx = -1;
        }
      });
    }

    attachAutocomplete('source','source-suggestions','/get_station_suggestions');
    attachAutocomplete('destination','destination-suggestions','/get_station_suggestions');

    ['source','destination'].forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener('keydown', function(e){
        const box = document.getElementById(id + '-suggestions');
        if (box && box.style.display !== 'none' && e.key === 'Enter') e.preventDefault();
      });
    });

    document.querySelectorAll('.date-icon').forEach(icon=>{
      const input = icon.closest('.date-wrap').querySelector('.date-input');
      icon.addEventListener('click', (ev)=>{
        ev.preventDefault();
        if (!input) return;
        if (typeof input.showPicker === 'function') input.showPicker();
        else { input.focus(); try { input.click(); } catch(e){} }
      });
    });

    document.getElementById('resetBtn').addEventListener('click', function(){
      document.getElementById('trainForm').reset();
      const d = new Date(); d.setHours(0,0,0,0); d.setDate(d.getDate()+1);
      document.getElementById('journey_date').value = d.toISOString().split('T')[0];
      updateHiddenDateFields();
    });

    document.getElementById('trainForm').addEventListener('submit', function(e){
      updateHiddenDateFields();
      const source = document.getElementById('source').value.trim();
      const destination = document.getElementById('destination').value.trim();
      const journey_date = document.getElementById('journey_date').value;
      const travelClass = document.getElementById('class').value;
      if (!source || !destination || !journey_date || !travelClass) {
        e.preventDefault();
        alert('Please fill Source, Destination, Date and Class.');
        return false;
      }
      showLoader();
    });

    document.addEventListener('keydown', function(ev){
      if ((ev.ctrlKey || ev.metaKey) && ev.key.toLowerCase() === 'k') {
        ev.preventDefault();
        document.getElementById('source').focus();
      }
    });

    window.addEventListener('pageshow', ()=>{ hideLoader(); });
    window.addEventListener('beforeunload', ()=>{ hideLoader(); });
  </script>
</body>
</html>